# Switch Unbrick Guide

## Quick reference
- [My switch seemingly does nothing when i try to boot it up normally](#early-boot-errors)
- [My switch shows the Nintendo/blackwhite atmosphere logo, then blackscreens](#mid-boot-errors)
- [My switch gets stuck at the Switch logo](#late-boot-errors)
- [My switch crashes on boot](#boot-crashes)
- [Last Resort: Full on MMC rebuild guide](#mmc-rebuild)

## Early Boot Errors

1. Check if you can boot via RCM/Hekate
    - If you can, you likely have a fuse mismatch on your hands. Update to the latest firmware
2. Restore a Nand backup if you have one
3. Follow everything from the [MMC Rebuild](#mmc-rebuild) section with the same fw version as your current fw

## Mid Boot Errors

1. Check if you can boot via RCM/Hekate or stock
    - If you can boot stock but not cfw, you might be running too many sysmodules, try to disable some.
2. Check if you have an exFAT sd. If you have, format it to fat32 
3. Check if your system partition is mountable. This can be done via [TegraExplorer](https://github.com/suchmememanyskill/TegraExplorer/releases)
4. Restore a Nand backup if you have one
5. Follow everything from the [MMC Rebuild](#mmc-rebuild) section

## Late Boot Errors

1. Check if you can boot via RCM/Hekate or stock
    - If you can boot stock but not cfw, you might be running too many sysmodules, try to disable some.
2. Check if your USER partition is mountable. This can be done via [TegraExplorer](https://github.com/suchmememanyskill/TegraExplorer/releases)
3. Check if your PRODINFO is fine. Decrypted prodinfo's start with `CAL0` in a hex editor
4. Restore a Nand Backup if you have one
5. Perform a [System Wipe](#system-wipe)
6. Follow everything from the [MMC Rebuild](#mmc-rebuild) section

## Boot Crashes

1. If booting via Atmosphere/Hekate, you'll get a TitleID/ProgramID for which program crashed. Check if this ID is in Atmosphere/contents, and if it is, delete it
2. Check if you can boot normally
    - If you can, your cfw setup is likely fucked
3. Perform a [System Wipe](#system-wipe)


## MMC Rebuild

### Step 0: Making a nand backup
You probably want to make a nand backup before you start modifying your switch. Boot into [Hekate](https://github.com/CTCaer/hekate/releases), Go to tools, Backup eMMC, and backup both `eMMC BOOT0 & BOOT1` and `eMMC RAW GPP`

### Step 1: Getting the files

What you need:

- Your own prod.keys file (This needs to be yours specifically (Unless you are trying to just generate the BIS files)! If you don't have them, try to dump them via [Lockpick_RCM](https://github.com/shchmue/Lockpick_RCM/releases))
- Your switch firmware (Try to dump them via [Tegraexplorer](https://github.com/suchmememanyskill/TegraExplorer/releases) if you don't have them)
- [EmmcHaccGen](https://github.com/suchmememanyskill/EmmcHaccGen/releases)

Instructions:

1. Extract the EmmcHaccGen zip somewhere, and place the prod.keys and the fw dump in the same folder
2. Open up a cmd prompt in the same folder, and execute the command `EmmcHaccGen.exe --keys (location of the prod.keys file) --fw (location of the firmware folder)` (example: `EmmcHaccGen --keys prod.keys --fw 9.1.0)`)
3. You should now have a folder called NX-(fw version)_exFAT. If you do, you can continue

### Step 2: Flashing the files

What you need:

- The boot.bis file and SYSTEM folder generated by emmchaccgen
- <a href="https://suchmememanyskill.github.io/TegraScript/scripts/systemRestore.te" download>systemRestore.te</a>
- [TegraExplorer](https://github.com/suchmememanyskill/TegraExplorer/releases)

Instructions:

1. Make a folder on your sd card, then copy boot.bis, SYSTEM and systemrestore.te in that folder
2. Insert your sd card in your switch and inject `Tegraexplorer.bin`
3. Navigate to SD, your folder, systemRestore.te and then `Launch Script`
4. Follow the script til completion
5. Try to boot your switch with Atmosphere.
    - Note: if you followed the entirety of this guide, AutoRCM will be enabled! You need to boot via RCM
    - If you do not have a basic Atmosphere setup on your SD, Download the atmosphere zip and fusee-primary.bin from [here](https://github.com/Atmosphere-NX/Atmosphere/releases). Extract the contents of the zip to the root of your sd, and inject fusee-primary.bin
    - If your switch does not boot, perform the [System Wipe](#system-wipe)

## System Wipe

!!! Danger "System Wipe"
    This will wipe everything from your system. Including saves, installed games and everything else. Be safe and always have a nand backup

What you need:

- [TegraExplorer](https://github.com/suchmememanyskill/TegraExplorer/releases)
- <a href="https://suchmememanyskill.github.io/TegraScript/scripts/systemwipe.te" download>systemwipe.te</a>

Instructions:

1. Put the systemwipe.tegrascript script on the root of your sd card
2. Inject TegraExplorer using your favorite payload injector (for example TegraRcmGui)
3. Navigate to your SD, then select `systemwipe.te`, then `Launch Script`
4. Press vol+ to wipe saves from sysmmc
5. Confirm using vol+
